{"version":3,"file":"commonHelpers.js","sources":["../src/js/api.js","../src/js/index.js"],"sourcesContent":["import axios from \"axios\";\n\nconst BASE_URL = 'https://pixabay.com/api/'\nconst API_KEY = '21698474-fb36d7b3400c91ab3d227d6db'\n\nexport const per_page = 40\n\nexport const fetchImages = async (query, page = 1) => {\n  if (!query) return\n  const params = new URLSearchParams({\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page,\n    page\n  })\n  try {\n    const responce = await axios.get(`${BASE_URL}?key=${API_KEY}&${params}`)\n    return responce.data\n  }\n  catch (err) {\n    console.log(err)\n    throw new Error(err)\n  }\n}","import iziToast from \"izitoast\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport { fetchImages } from './api'\nimport { per_page } from './api'\n\nconst formReff = document.querySelector('#search-form')\nconst galeryReff = document.querySelector('.gallery')\nconst loadMoreBtnReff = document.querySelector('.load-more')\nconst guardReff = document.querySelector('.js-guard')\n\nlet lightbox = new SimpleLightbox('.gallery a', { captions: true, captionDelay: 250 });\n\nlet options = {\n  root: document.querySelector(\"#scrollArea\"),\n  rootMargin: \"300px\",\n  threshold: 1.0,\n};\n\n// let observer = new IntersectionObserver(handleLoadMoreObserver, options);\n// observer.observe(guardReff)\n\nlet formItems = {}\nlet page = 1\n\nformReff.addEventListener('submit', handleSubmit)\nloadMoreBtnReff.addEventListener('click', handleLoadMore)\n\nasync function handleSubmit(evt) {\n  evt.preventDefault()\n  galeryReff.innerHTML = ''\n  loadMoreBtnReff.classList.add('visually-hidden')\n\n  const formData = new FormData(evt.currentTarget)\n  formData.forEach((value, key) => {\n    formItems[key] = value.trim()\n  })\n\n  formReff.reset()\n  page = 1\n\n  const images = await fetchImages(formItems.searchQuery, page)\n  if (!images || !images.hits.length) {\n    iziToast.show({\n      title: '',\n      color: 'red',\n      position: 'topCenter',\n      message: `Sorry, there are no images matching your search query. Please try again.`\n    });\n    return\n  }\n\n  if (images.totalHits > 0) {\n    iziToast.show({\n      title: '',\n      color: 'green',\n      position: 'topCenter',\n      message: `Hooray! We found totalHits images ${images.totalHits}`\n    });\n  }\n\n  if (images.hits.length >= per_page) {\n    loadMoreBtnReff.classList.remove('visually-hidden')\n  }\n\n  createMarcup(images)\n  lightbox.refresh()\n}\n\nasync function createMarcup(data) {\n  if (!data) return\n  const { hits } = data\n  const marcup = hits.map(({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => (\n    `\n    <li class='gallery__item'>\n      <div class=\"gallery__card\">\n        <a class=\"gallery__link\" href='${largeImageURL}'>\n          <img\n            class=\"gallery__image\"\n            src=${webformatURL} \n            alt=${tags} \n            data-source=\"${webformatURL}\" \n            loading=\"lazy\" />\n        </a>\n          <div class=\"info\">\n            <p class=\"info-item\">\n              <b>Likes</b>\n              ${likes}\n            </p>\n            <p class=\"info-item\">\n               <b>Views</b>\n                ${views}\n            </p>\n            <p class=\"info-item\">\n               <b>Comments</b>\n                ${comments}\n            </p>\n            <p class=\"info-item\">\n              <b>Downloads</b>\n               ${downloads}\n            </p>\n          </div>\n      </div>\n    </li>\n  `\n  )).join('')\n  galeryReff.insertAdjacentHTML('beforeend', marcup)\n}\n\nasync function handleLoadMore() {\n  page += 1\n  const images = await fetchImages(formItems.searchQuery, page)\n  createMarcup(images)\n  lightbox.refresh()\n  if (images.hits.length < per_page) {\n    loadMoreBtnReff.classList.add('visually-hidden')\n    iziToast.show({\n      title: '',\n      color: 'red',\n      position: 'topRight',\n      message: \"We're sorry, but you've reached the end of search results.\"\n    });\n  }\n\n  const { height: cardHeight } = document\n    .querySelector(\".gallery\")\n    .firstElementChild.getBoundingClientRect();\n  window.scrollBy({\n    top: cardHeight * 2,\n    behavior: \"smooth\",\n  });\n}\n\nasync function handleLoadMoreObserver(entries) {\n  entries.forEach(async (entry) => {\n    if (entry.isIntersecting) {\n      page += 1\n      const images = await fetchImages(formItems.searchQuery, page)\n      if (images?.hits.length < per_page) {\n        iziToast.show({\n          title: '',\n          color: 'red',\n          position: 'topRight',\n          message: \"We're sorry, but you've reached the end of search results.\"\n        });\n        return\n      }\n\n      createMarcup(images)\n      lightbox.refresh()\n    }\n  })\n}"],"names":["BASE_URL","API_KEY","per_page","fetchImages","query","page","params","axios","err","formReff","galeryReff","loadMoreBtnReff","lightbox","SimpleLightbox","formItems","handleSubmit","handleLoadMore","evt","value","key","images","iziToast","createMarcup","data","hits","marcup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","cardHeight"],"mappings":"owBAEA,MAAMA,EAAW,2BACXC,EAAU,qCAEHC,EAAW,GAEXC,EAAc,MAAOC,EAAOC,EAAO,IAAM,CACpD,GAAI,CAACD,EAAO,OACZ,MAAME,EAAS,IAAI,gBAAgB,CACjC,EAAGF,EACH,WAAY,QACZ,YAAa,aACb,WAAY,GACZ,SAAAF,EACA,KAAAG,CACJ,CAAG,EACD,GAAI,CAEF,OADiB,MAAME,EAAM,IAAI,GAAGP,SAAgBC,KAAWK,GAAQ,GACvD,IACjB,OACME,EAAP,CACE,cAAQ,IAAIA,CAAG,EACT,IAAI,MAAMA,CAAG,CACpB,CACH,EClBMC,EAAW,SAAS,cAAc,cAAc,EAChDC,EAAa,SAAS,cAAc,UAAU,EAC9CC,EAAkB,SAAS,cAAc,YAAY,EACzC,SAAS,cAAc,WAAW,EAEpD,IAAIC,EAAW,IAAIC,EAAe,aAAc,CAAE,SAAU,GAAM,aAAc,GAAG,CAAE,EAG7E,SAAS,cAAc,aAAa,EAQ5C,IAAIC,EAAY,CAAE,EACdT,EAAO,EAEXI,EAAS,iBAAiB,SAAUM,CAAY,EAChDJ,EAAgB,iBAAiB,QAASK,CAAc,EAExD,eAAeD,EAAaE,EAAK,CAC/BA,EAAI,eAAgB,EACpBP,EAAW,UAAY,GACvBC,EAAgB,UAAU,IAAI,iBAAiB,EAE9B,IAAI,SAASM,EAAI,aAAa,EACtC,QAAQ,CAACC,EAAOC,IAAQ,CAC/BL,EAAUK,GAAOD,EAAM,KAAM,CACjC,CAAG,EAEDT,EAAS,MAAO,EAChBJ,EAAO,EAEP,MAAMe,EAAS,MAAMjB,EAAYW,EAAU,YAAaT,CAAI,EAC5D,GAAI,CAACe,GAAU,CAACA,EAAO,KAAK,OAAQ,CAClCC,EAAS,KAAK,CACZ,MAAO,GACP,MAAO,MACP,SAAU,YACV,QAAS,0EACf,CAAK,EACD,MACD,CAEGD,EAAO,UAAY,GACrBC,EAAS,KAAK,CACZ,MAAO,GACP,MAAO,QACP,SAAU,YACV,QAAS,qCAAqCD,EAAO,WAC3D,CAAK,EAGCA,EAAO,KAAK,QAAUlB,GACxBS,EAAgB,UAAU,OAAO,iBAAiB,EAGpDW,EAAaF,CAAM,EACnBR,EAAS,QAAS,CACpB,CAEA,eAAeU,EAAaC,EAAM,CAChC,GAAI,CAACA,EAAM,OACX,KAAM,CAAE,KAAAC,CAAI,EAAKD,EACXE,EAASD,EAAK,IAAI,CAAC,CAAE,aAAAE,EAAc,cAAAC,EAAe,KAAAC,EAAM,MAAAC,EAAO,MAAAC,EAAO,SAAAC,EAAU,UAAAC,CAAW,IAC/F;AAAA;AAAA;AAAA,yCAGqCL;AAAA;AAAA;AAAA,kBAGvBD;AAAA,kBACAE;AAAA,2BACSF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAMXG;AAAA;AAAA;AAAA;AAAA,kBAIEC;AAAA;AAAA;AAAA;AAAA,kBAIAC;AAAA;AAAA;AAAA;AAAA,iBAIDC;AAAA;AAAA;AAAA;AAAA;AAAA,GAMd,EAAE,KAAK,EAAE,EACVtB,EAAW,mBAAmB,YAAae,CAAM,CACnD,CAEA,eAAeT,GAAiB,CAC9BX,GAAQ,EACR,MAAMe,EAAS,MAAMjB,EAAYW,EAAU,YAAaT,CAAI,EAC5DiB,EAAaF,CAAM,EACnBR,EAAS,QAAS,EACdQ,EAAO,KAAK,OAASlB,IACvBS,EAAgB,UAAU,IAAI,iBAAiB,EAC/CU,EAAS,KAAK,CACZ,MAAO,GACP,MAAO,MACP,SAAU,WACV,QAAS,4DACf,CAAK,GAGH,KAAM,CAAE,OAAQY,CAAU,EAAK,SAC5B,cAAc,UAAU,EACxB,kBAAkB,sBAAqB,EAC1C,OAAO,SAAS,CACd,IAAKA,EAAa,EAClB,SAAU,QACd,CAAG,CACH"}